{
  "id": "snapshot_1764894493170_nrwqxau9x",
  "approvalId": "approval_1764894493152_9dap2edlc",
  "approvalTitle": "Requirements: Fully Functional Skeleton",
  "version": 1,
  "timestamp": "2025-12-05T00:28:13.170Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Requirements Document: Fully Functional Skeleton\r\n\r\n## Introduction\r\n\r\n本規格書定義了「全功能空殼應用 (Fully Functional Skeleton)」的需求，目標是為 Angular v21 企業級應用打下堅實的地基。這個空殼將包含完整的目錄結構、視覺系統、核心服務框架、路由網絡，以及開發者體驗優化，使後續功能開發能在一致且穩固的基礎上進行。\r\n\r\n## Alignment with Product Vision\r\n\r\n本 Spec 直接支持 `product.md` 中定義的核心目標：\r\n\r\n- **Zoneless Architecture**: 所有服務和組件將遵循 Signal-based 響應式模式\r\n- **Router-First Design**: 路由表將作為應用架構的骨幹\r\n- **Hybrid Reactive Pattern**: AuthService 將展示 RxJS 內部處理 + Signals 外部暴露的標準模式\r\n- **Constitution Over Convention**: 嚴格遵循 `tech.md` 中的技術憲法，無例外\r\n\r\n---\r\n\r\n## Requirements\r\n\r\n### Requirement 1: Directory Structure (骨架)\r\n\r\n**User Story:** As a developer, I want the project directory structure to be physically established according to the Steering documents, so that I have clear boundaries for placing code in Core, Shared, and Features layers.\r\n\r\n#### Acceptance Criteria\r\n\r\n1. WHEN the project is initialized THEN the system SHALL have the following directory structure:\r\n   ```\r\n   src/app/\r\n   ├── core/\r\n   │   ├── auth/\r\n   │   ├── layout/\r\n   │   │   ├── header/\r\n   │   │   ├── sidebar/\r\n   │   │   └── footer/\r\n   │   ├── config/\r\n   │   └── services/\r\n   ├── shared/\r\n   │   ├── ui/\r\n   │   ├── pipes/\r\n   │   ├── directives/\r\n   │   └── utils/\r\n   └── features/\r\n       ├── home/\r\n       ├── auth/\r\n       └── not-found/\r\n   ```\r\n\r\n2. IF a developer creates a new file THEN the system SHALL provide clear folder locations based on the file's responsibility (Core for singletons, Shared for reusables, Features for business logic).\r\n\r\n3. WHEN importing modules THEN the system SHALL support path aliases `@core/*`, `@shared/*`, `@features/*` without relative path navigation.\r\n\r\n---\r\n\r\n### Requirement 2: Visual System (血肉)\r\n\r\n**User Story:** As a developer, I want Tailwind CSS and PrimeNG properly configured with global CSS reset and font settings, so that I can build consistent UI without fighting style conflicts.\r\n\r\n#### Acceptance Criteria\r\n\r\n1. WHEN the application loads THEN the system SHALL apply Tailwind CSS utility classes globally.\r\n\r\n2. WHEN the application loads THEN the system SHALL have PrimeNG theme configured and ready for use.\r\n\r\n3. WHEN the application loads THEN the system SHALL apply a CSS reset (normalize/modern-normalize) to ensure cross-browser consistency.\r\n\r\n4. WHEN the application loads THEN the system SHALL have a default font family configured (Inter or system fonts) applied globally.\r\n\r\n5. IF a developer uses Tailwind utilities alongside PrimeNG components THEN the system SHALL NOT have style conflicts.\r\n\r\n---\r\n\r\n### Requirement 3: Layout System (佈局)\r\n\r\n**User Story:** As a developer, I want two standard layout templates (blank for pre-login, admin shell for post-login), so that I can wrap pages appropriately based on authentication state.\r\n\r\n#### Acceptance Criteria\r\n\r\n1. WHEN a user visits a pre-login page (e.g., login page) THEN the system SHALL render a blank/minimal layout without navigation elements.\r\n\r\n2. WHEN a user visits a post-login page (e.g., dashboard) THEN the system SHALL render an admin layout with:\r\n   - **Header**: Top navigation bar with app logo and user menu placeholder\r\n   - **Sidebar**: Left navigation menu (collapsible)\r\n   - **Footer**: Bottom bar with copyright/version info\r\n   - **Content Area**: Main content slot using `<router-outlet>`\r\n\r\n3. WHEN the sidebar is toggled THEN the system SHALL animate the collapse/expand transition smoothly.\r\n\r\n4. IF the viewport is mobile-sized THEN the sidebar SHALL be hidden by default and accessible via hamburger menu.\r\n\r\n---\r\n\r\n### Requirement 4: Core Services - AuthService (神經系統)\r\n\r\n**User Story:** As a developer, I want an AuthService shell with Signal-based state management, so that UI components can reactively respond to authentication state changes.\r\n\r\n#### Acceptance Criteria\r\n\r\n1. WHEN AuthService is initialized THEN the system SHALL expose the following public Signals:\r\n   - `currentUser: Signal<User | null>` - Current authenticated user\r\n   - `isLoggedIn: Signal<boolean>` - Computed from currentUser\r\n   - `isLoading: Signal<boolean>` - Authentication operation in progress\r\n\r\n2. WHEN `login()` method is called THEN the system SHALL update the `currentUser` Signal (mock implementation for now).\r\n\r\n3. WHEN `logout()` method is called THEN the system SHALL set `currentUser` to `null`.\r\n\r\n4. IF a component reads `isLoggedIn()` THEN the system SHALL return `true` when `currentUser` is not null, `false` otherwise.\r\n\r\n5. WHEN AuthService is injected THEN it SHALL be a singleton (providedIn: 'root').\r\n\r\n---\r\n\r\n### Requirement 5: Core Services - Error Handling & Interceptors (神經系統)\r\n\r\n**User Story:** As a developer, I want global error handling and HTTP interceptor frameworks in place, so that I have centralized control over error reporting and HTTP request/response processing.\r\n\r\n#### Acceptance Criteria\r\n\r\n1. WHEN an unhandled error occurs anywhere in the application THEN the system SHALL catch it via GlobalErrorHandler and log it to console (extensible for future logging services).\r\n\r\n2. WHEN an HTTP request is made THEN the system SHALL pass through an AuthInterceptor that can:\r\n   - Attach authorization headers (placeholder)\r\n   - Handle 401/403 responses (placeholder)\r\n\r\n3. WHEN an HTTP error occurs THEN the system SHALL pass through an ErrorInterceptor that can:\r\n   - Transform error responses into a consistent format\r\n   - Optionally trigger global error notifications (placeholder)\r\n\r\n4. IF interceptors are configured THEN they SHALL be registered in `app.config.ts` using `provideHttpClient(withInterceptors([...]))`.\r\n\r\n---\r\n\r\n### Requirement 6: Core Services - Configuration (神經系統)\r\n\r\n**User Story:** As a developer, I want application configuration centralized and injectable, so that I can access environment-specific settings without hardcoding values.\r\n\r\n#### Acceptance Criteria\r\n\r\n1. WHEN the application starts THEN the system SHALL provide an `APP_CONFIG` InjectionToken with:\r\n   - `apiUrl: string` - Base API URL\r\n   - `appName: string` - Application name\r\n   - `version: string` - Application version\r\n\r\n2. WHEN a service needs configuration THEN it SHALL inject `APP_CONFIG` token instead of importing environment files directly.\r\n\r\n3. IF configuration values need to change per environment THEN the system SHALL support overriding via environment-specific providers.\r\n\r\n---\r\n\r\n### Requirement 7: Routing System (交通網絡)\r\n\r\n**User Story:** As a developer, I want a complete routing table with lazy loading, guards, and essential pages, so that navigation works correctly from day one.\r\n\r\n#### Acceptance Criteria\r\n\r\n1. WHEN the application loads THEN the system SHALL have routes configured for:\r\n   - `/` - Redirects to `/home`\r\n   - `/home` - Home page (lazy-loaded)\r\n   - `/auth/login` - Login page (lazy-loaded, blank layout)\r\n   - `/**` - 404 Not Found page\r\n\r\n2. WHEN navigating to a feature route THEN the system SHALL lazy-load the feature module using `loadChildren` or `loadComponent`.\r\n\r\n3. WHEN a protected route is accessed THEN the system SHALL check `authGuard` (returns `true` for now, placeholder for future implementation).\r\n\r\n4. WHEN an unknown route is accessed THEN the system SHALL display a styled 404 page with navigation back to home.\r\n\r\n5. IF route transitions occur THEN the system SHALL support future animation hooks via route data.\r\n\r\n---\r\n\r\n### Requirement 8: Developer Experience (開發體驗)\r\n\r\n**User Story:** As a developer, I want path aliases configured in tsconfig, so that I can use clean imports like `@core/auth/auth.service` instead of relative paths.\r\n\r\n#### Acceptance Criteria\r\n\r\n1. WHEN importing from Core layer THEN the system SHALL support `@core/*` alias resolving to `src/app/core/*`.\r\n\r\n2. WHEN importing from Shared layer THEN the system SHALL support `@shared/*` alias resolving to `src/app/shared/*`.\r\n\r\n3. WHEN importing from Features layer THEN the system SHALL support `@features/*` alias resolving to `src/app/features/*`.\r\n\r\n4. IF IDE (VS Code) is used THEN path aliases SHALL provide autocomplete and navigation support.\r\n\r\n---\r\n\r\n## Non-Functional Requirements\r\n\r\n### Code Architecture and Modularity\r\n\r\n- **Single Responsibility Principle**: Each file has one purpose (e.g., `auth.service.ts` only handles auth state)\r\n- **Modular Design**: Core, Shared, Features are strictly separated with no circular dependencies\r\n- **Dependency Management**: Features can import from Core and Shared; Shared cannot import from Core; Core cannot import from Features\r\n- **Clear Interfaces**: Services expose Signals as public API; internal RxJS streams are private\r\n\r\n### Performance\r\n\r\n- **OnPush Change Detection**: All components MUST use `ChangeDetectionStrategy.OnPush`\r\n- **Lazy Loading**: All feature modules MUST be lazy-loaded\r\n- **Zoneless Ready**: No Zone.js dependencies; all state changes via Signals\r\n\r\n### Security\r\n\r\n- **Interceptor Framework**: HTTP interceptors ready for token attachment and error handling\r\n- **Guard Framework**: Route guards ready for authentication/authorization checks\r\n\r\n### Reliability\r\n\r\n- **Global Error Handling**: Unhandled errors are caught and logged\r\n- **Consistent Error Format**: HTTP errors transformed to predictable structure\r\n\r\n### Usability\r\n\r\n- **Responsive Layout**: Admin layout adapts to mobile/tablet/desktop\r\n- **Accessible Navigation**: Keyboard navigable sidebar and header\r\n\r\n---\r\n\r\n## Acceptance Test\r\n\r\n**Final Validation**: After implementing this spec, the following MUST be true:\r\n\r\n1. `pnpm start` successfully starts the dev server without errors\r\n2. Browser shows a styled home page with admin layout (header, sidebar, footer)\r\n3. Clicking navigation items switches routes without page reload\r\n4. Console shows no red error messages\r\n5. Visiting `/auth/login` shows blank layout\r\n6. Visiting `/unknown-route` shows styled 404 page\r\n7. All imports use path aliases (`@core/`, `@shared/`, `@features/`)\r\n",
  "fileStats": {
    "size": 10431,
    "lines": 231,
    "lastModified": "2025-12-05T00:28:05.600Z"
  },
  "comments": []
}